```{r}
knitr::opts_chunk$set(warnings = FALSE, message = FALSE)
```


```{r}
source("/home/realiseshewon/PDev/kde-ranking/R/get_plots.R")
dataset<-readRDS("/home/realiseshewon/PDev/kde-ranking/data/true_theta.rds")
```

## True $\theta$ Values Used in the Simulation

The actual $\theta$ values used in the simulation are shown in Table \@ref(tab:true-theta-table). Figure \@ref(fig:true-theta-boxplot) shows how the spread of the $\theta$ varies in the cases considered.

```{r true-theta-table, tab.cap="True $\\theta$ values used in the simulation have different levels of variability."}
source("/home/realiseshewon/PDev/kde-ranking/R/get_tables.R")
get_table_for_true_theta(
  dataset %>% 
  select(K, data_spread, true_theta) %>%
  group_by(K, data_spread)%>%
  summarise(true_theta = paste(round(true_theta,1), collapse = ", "))
)
```

```{r true-theta-boxplot, fig.cap="True $\\theta$ values used in the simulation have different levels of variability.", message = FALSE, warning=FALSE, fig.pos='H'}
get_boxplot_for_true_theta(dataset)
```








```{r simulation-table1, results='asis', include=FALSE}
library(dplyr)
library(tidyr)
mean <- 23.8
sds <-c('low', 'medium', 'high')# c(2, 3.6, 6)
Ks <- c(10, 20, 30, 40, 50)
#corrs <- c(0.1,0.5,0.9)
alphas <- c(0.05)#c(0.05, 0.1, 0.15, 0.2)

theta <- c()
std <- c()
K <- c()
i <- 1   # initialize index

for (k in Ks) {
  for (sd in sds) {

    set.seed(123974)
    true_theta <- sd #rnorm(k, mean, sd)
    value_to_add <- true_theta#paste(round(true_theta,1), collapse = ", ")
    theta[i] <- value_to_add
    std[i] <- sd
    K[i] <- k
    i <- i + 1
  }
}

reals <- data.frame(theta, K, std)


# grid <- grid %>%

# grid#dplyr::inner_join(grid, reals, by = c("std", "K"))

reals <- data.frame(theta, K, std)

K <- c(10, 20, 30, 40, 50)
sd <-c(2.0, 3.6, 6.0)# my_list
R_type <- c("R_eq", "R_block")

reals$R <- rep(list(R_type), nrow(reals))
table_to_plot <- reals %>%
  unnest(R) %>%
  mutate(
    `$\\mathbf{R}$` = case_when(
      R == "R_eq" ~ "$\\mathbf{R}_{\\text{eq}}, \\rho = 0.1, 0.5, 0.9$",
      R == "R_block" ~ "$\\mathbf{R}_{\\text{block}} \\text{(2 or 3 blocks)}$"
    )
  ) %>%
  select(theta, `$\\mathbf{R}$`, K)
```

```{r asis = TRUE, include = FALSE}
library(kableExtra)


kable(table_to_plot, "latex", booktabs = TRUE, escape = FALSE,linesep = "",
      longtable = TRUE) %>%
  column_spec(1, width = "10cm") %>%    # wrap column 1
  column_spec(2, width = "5cm") %>%
  kable_styling(
    latex_options = c("striped", "repeat_header", "HOLD_position"),
    stripe_color = "gray!15"  # light gray, can change
  )
```

## Codes for algorithm 1 {.unnumbered}

```{r simulation-table, results='asis', include=FALSE}
library(dplyr)
library(tidyr)
mean <- 23.8
sds <- c(2, 3.6, 6)
Ks <- c(10, 20, 30, 40, 50)
#corrs <- c(0.1,0.5,0.9)
alphas <- c(0.05)#c(0.05, 0.1, 0.15, 0.2)

theta <- c()
std <- c()
K <- c()
i <- 1   # initialize index

for (k in Ks) {
  for (sd in sds) {

    set.seed(123974)
    true_theta <- rnorm(k, mean, sd)
    value_to_add <- paste(round(true_theta,1), collapse = ", ")
    theta[i] <- value_to_add
    std[i] <- sd
    K[i] <- k
    i <- i + 1
  }
}

reals <- data.frame(theta, K, std)


# grid <- grid %>%

# grid#dplyr::inner_join(grid, reals, by = c("std", "K"))

reals <- data.frame(theta, K, std)

K <- c(10, 20, 30, 40, 50)
sd <-c(2.0, 3.6, 6.0)# my_list
R_type <- c("R_eq", "R_block")

reals$R <- rep(list(R_type), nrow(reals))
table_to_plot <- reals %>%
  unnest(R) %>%
  mutate(
    `$\\mathbf{R}$` = case_when(
      R == "R_eq" ~ "$\\mathbf{R}_{\\text{eq}}, \\rho = 0.1, 0.5, 0.9$",
      R == "R_block" ~ "$\\mathbf{R}_{\\text{block}} \\text{(2 or 3 blocks)}$"
    )
  ) %>%
  select(theta, `$\\mathbf{R}$`)
```

```{r asis = TRUE, include = FALSE}
library(kableExtra)


kable(table_to_plot, "latex", booktabs = TRUE, escape = FALSE,linesep = "",
      longtable = TRUE) %>%
  column_spec(1, width = "10cm") %>%    # wrap column 1
  column_spec(2, width = "5cm") %>%
  kable_styling(
    latex_options = c("striped", "repeat_header", "HOLD_position"),
    stripe_color = "gray!15"  # light gray, can change
  )
```

```{r, results='asis', echo=FALSE, warning=FALSE}
code <- readLines("../../R/simulate/compute_ci.R")
cat("```r\n", paste(code, collapse = "\n"), "\n```")
```

## Codes for algorithm 2 {.unnumbered}

```{r, results='asis', echo=FALSE, warning=FALSE}
code <- readLines("../../R/simulate/compute_metrics.R")
cat("```r\n", paste(code, collapse = "\n"), "\n```")
```

## Codes for simulation {.unnumbered}

```{r, results='asis', echo=FALSE, warning=FALSE}
code <- readLines("../../R/simulate/implement.R")
cat("```r\n", paste(code, collapse = "\n"), "\n```")
```

